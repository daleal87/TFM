<?xml version="1.0"?>

<launch>

    <node name="joy_node" pkg="joy" type="joy_node" output="screen" clear_params="true">
        <param name="dev" type="str" value="/dev/input/js1"/>
    </node>
    

    <arg name="control_mode" default="twist" />
    <!-- Launches the joystick controller -->
    <node name="ardrone_teleop" pkg="vision" type="ardrone_teleop" output="screen" required="true">
        <!-- Configures the joystick button mapping -->
        <param name="control_mode" value="$(arg control_mode)" />
        
                                        <!-- IMPORTANT INFORMATION -->
        <!-- Value of axis and buttons must be = ${THE ONE THAT INDICATES THE jstest-gtk APPLICATION} + 1 -->

        <!-- AXIS -->
        <param name="x_axis" value="2"/>
        <param name="y_axis" value="1"/>
        <param name="z_axis" value="4"/>
        <param name="yaw_axis" value="3"/>

        <!-- VELOCITY BUTTONS -->
        <param name="x_velocity_max" value="5"/>
        <param name="y_velocity_max" value="5"/>
        <param name="z_velocity_max" value="2"/>
        <param name="slow_button" value="6"/>

        <!-- TASK BUTTONS -->
        <!-- The comments refer to the SixAxis Controller (or PS3 Controller)--> 
        <param name="takeoff_button"            value="13" /> <!-- TRIANGULE     Button -->
        <param name="landing_button"            value="15" /> <!-- X             Button -->
        <param name="emergency_button"          value="14" /> <!-- CIRCLE (O)    Button -->
        <param name="reset_button"              value="4"  />
        <param name="tracking_button"           value="16" />        
        
        <param name="togglecam_button"          value="17" /> <!-- PS            Button -->
        <param name="flattrim_button"           value="1"  /> <!-- SELECT        Button -->

        <!-- TOPICS -->
        <param name="cmd_vel_topic"             value="/cmd_vel" />
        <param name="takeoff_topic"             value="/ardrone/takeoff" />
        <param name="landing_topic"             value="/ardrone/land" />
        <param name="emergency_topic"           value="/ardrone/emergency_topic" />
        <param name="reset_topic"               value="/ardrone/reset" />
        <param name="tracking_topic"            value="/ardrone/tracking_topic" />

        <param name="duration"                  value="0.5" />

    </node>


    <!-- ////////////////////////////// PLATFORM DETECTION NODE ////////////////////////////////////-->
    <!--
    <node name="platform_detection_real" pkg="vision" type="platform_detection_real" output="screen">
        <param name="cam_info_topic" value="/ardrone/bottom/camera_info"/>
        <param name="platform_position_topic" value="/platform/estimated_position"/>
        <param name="ardrone_navdata" value="/ardrone/navdata"/>
        <param name="imu_topic" value="/ardrone/imu"/>
    </node>
    -->


    <!-- /////////////////////////////////// ARUCO NODE ///////////////////////////////////////////-->
    <arg name="markerId"        default="7"/>
    <arg name="markerSize"      default="0.256"/>    <!-- in m -->
    <!-- <arg name="eye"             default="left"/> -->
    <arg name="marker_frame"    default="aruco_marker_frame"/>
    <arg name="ref_frame"       default="/odom"/>  <!-- leave empty and the pose will be published wrt param parent_name -->

    <node pkg="aruco_ros" type="single" name="aruco_single">
        <remap from="/camera_info" to="/ardrone/bottom/camera_info" />
        <remap from="/image" to="/ardrone/bottom/image_raw" />
        <param name="image_is_rectified" value="False"/>
        <param name="marker_size"        value="$(arg markerSize)"/>
        <param name="marker_id"          value="$(arg markerId)"/>
        <param name="reference_frame"    value="$(arg ref_frame)"/>   <!-- frame in which the marker pose will be refered -->
        <param name="camera_frame"       value="/ardrone_base_bottomcam"/>
        <param name="marker_frame"       value="$(arg marker_frame)" />
    </node>

 </launch>
